<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Log Dashboard - Real-time Monitoring</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../static/css/style.css" />
    <script src="../static/js/dashboard.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üåê Web Server Log Dashboard</h1>
        <div class="status-bar">
          <span id="statusIndicator" class="status-indicator status-idle"
            >‚ö™ Idle</span
          >
          <span class="total-entries"
            >Total: <span id="totalEntries">0</span></span
          >
        </div>
      </div>

      <div class="update-status">
        <span id="updateStatus">Initializing...</span>
      </div>
      <!-- Log Entries Section -->
      <div class="logs-section">
        <div class="logs-header">
          <h2>üìã Log Entries</h2>
          <div class="logs-controls">
            <button class="btn btn-primary" onclick="loadLogs()">
              üîÑ Refresh
            </button>
            <button class="btn btn-secondary" onclick="toggleAutoRefresh()">
              <span id="autoRefreshText">‚è∏Ô∏è Pause Auto-refresh</span>
            </button>
          </div>
        </div>

        <!-- Search Form -->
        <div class="search-form">
          <h3>üîç Search Filters</h3>
          <form id="searchForm" onsubmit="handleSearch(event)">
            <div class="search-grid">
              <div class="search-field">
                <label for="searchIp">IP Address</label>
                <input
                  type="text"
                  id="searchIp"
                  name="ip"
                  placeholder="e.g. 192.168.1.1"
                />
              </div>

              <div class="search-field">
                <label for="searchPath">Request Path</label>
                <input
                  type="text"
                  id="searchPath"
                  name="path"
                  placeholder="e.g. /api/users"
                />
              </div>

              <div class="search-field">
                <label for="searchMethod">Method</label>
                <select id="searchMethod" name="method">
                  <option value="">All Methods</option>
                  <option value="GET">GET</option>
                  <option value="POST">POST</option>
                  <option value="PUT">PUT</option>
                  <option value="DELETE">DELETE</option>
                  <option value="PATCH">PATCH</option>
                  <option value="HEAD">HEAD</option>
                  <option value="OPTIONS">OPTIONS</option>
                </select>
              </div>

              <div class="search-field">
                <label for="searchSizeMin">Size Min (bytes)</label>
                <input
                  type="number"
                  id="searchSizeMin"
                  name="size_min"
                  placeholder="0"
                  min="0"
                />
              </div>

              <div class="search-field">
                <label for="searchSizeMax">Size Max (bytes)</label>
                <input
                  type="number"
                  id="searchSizeMax"
                  name="size_max"
                  placeholder="1000000"
                  min="0"
                />
              </div>
            </div>

            <div class="search-actions">
              <button type="submit" class="btn btn-primary">üîç Search</button>
              <button
                type="button"
                class="btn btn-danger"
                onclick="clearSearch()"
              >
                üóëÔ∏è Clear
              </button>
            </div>
          </form>

          <div id="activeFilters" class="active-filters"></div>
        </div>

        <div id="logsContainer">
          <table class="logs-table">
            <thead>
              <tr>
                <th>Time</th>
                <th>IP</th>
                <th>Method</th>
                <th>Path</th>
                <th>Status</th>
                <th>Size</th>
                <th>User Agent</th>
              </tr>
            </thead>
            <tbody id="logsTableBody">
              <tr>
                <td colspan="7" style="text-align: center; padding: 20px">
                  Loading logs...
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="pagination">
          <button
            class="btn btn-secondary"
            id="prevBtn"
            onclick="changePage(-1)"
          >
            ‚Üê Previous
          </button>
          <span class="pagination-info" id="pageInfo">Page 1 of 1</span>
          <button
            class="btn btn-secondary"
            id="nextBtn"
            onclick="changePage(1)"
          >
            Next ‚Üí
          </button>
        </div>
      </div>

      <div class="dashboard">
        <div class="card">
          <h2>üìà Requests Per Minute (RPM)</h2>
          <p style="color: #6b7280; font-size: 14px; margin-bottom: 10px">
            Bi·ªÉu ƒë·ªì ƒë∆∞·ªùng hi·ªÉn th·ªã s·ªë l∆∞·ª£ng request m·ªói ph√∫t
          </p>
          <div class="chart-container">
            <canvas id="rpmChart"></canvas>
          </div>
        </div>
      </div>

      <div class="stats-grid">
        <div class="card">
          <h2>üîù Top IPs</h2>
          <ul id="topIps" class="stats-list"></ul>
        </div>

        <div class="card">
          <h2>üõ§Ô∏è Top Paths</h2>
          <ul id="topPaths" class="stats-list"></ul>
        </div>

        <div class="card">
          <h2>üìä Status Codes</h2>
          <ul id="topStatusCodes" class="stats-list"></ul>
        </div>
      </div>
    </div>
  </body>
</html>
